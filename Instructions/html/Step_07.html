
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Step 7: Integration Code Verification</title><meta name="generator" content="MATLAB 9.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-01-14"><meta name="DC.source" content="Step_07.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:14px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:2.0em; color:#000077; line-height:150%; font-weight:bold; text-align:center }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.6em; color:#444444; font-weight:bold; font-style:italic; text-align:left; vertical-align:bottom; line-height:200%; border-top:2px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#555555; font-style:italic; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px;} 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Step 7: Integration Code Verification</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#2">Verification and Validation Tools Used</a></li><li><a href="#3">Static verification</a></li><li><a href="#4">Summary</a></li></ul></div><h2>Introduction<a name="1"></a></h2><p>In most embedded system, the final product contains hand and auto gen code that will be downloaded into processor.  In this workshop will go throught an example of simple scheduler, analog and discrete IO&#8217;s processing, and fault log.  We will be use Polyspace Code Prover static analysis tool to detect run time error on the integrated (hand and auto gen) code.</p><p>The following diagram describes the recommendation usage of Polyspace in the embedded system development where hand and auto generated code integration is applicable.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_12.png" alt=""> </p><h2>Verification and Validation Tools Used<a name="2"></a></h2><div><ul><li>Polyspace Code Prover</li></ul></div><h2>Static verification<a name="3"></a></h2><p>Creating Polyspace Code Prover project that contains hand code, S-Function, and Auto Generated Code.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_01.png" alt=""> </p><p>Provide name in the &#8220;Project Name&#8221; and &#8220;Location&#8221; fields. The location field is where the results will be stored. Keep the remaining default options and click "Next".</p><p>Add the C source code files (.c) to the project and specifiy the folders containing include (.h) files in the include paths.  Add recursively only if there are subfolders containing source and include files you need to compile the source files.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_02.png" alt=""> </p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_03.png" alt=""> </p><p>Most compiler specific language extensions are recognized by Polyspace by selecting compiler vendor and dialect in the setup.  For exotic extensions, there are extension hooks in the product that allow you to verify even the most extension laden source code. Select the gnu4.9 dialect in the compiler option for this example.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_06.png" alt=""> </p><p>Omit the main.c from the verification initially by right-clicking it and selecting "Exclude Files".</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_07.png" alt=""> </p><p><b>Save the Polyspace configuration and run.</b></p><p>In the next section we will review the Polyspace results.  Make hand code chnages and re-run Polyspace.</p><p><b>Reviewing Code Prover results</b></p><p>This is a run-time error in the hand code.  Please investigate the root cause of the issue.</p><p>Modify the scheduler file at line 16 from &#8220;&lt;=&#8221; to &#8220;&lt;&#8221; and re-run Code Prover.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_08.png" alt=""> </p><p>A non-terminating loop caused the cruise control to power off during fault testing.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_08B.png" alt=""> </p><p>The fault_log function is called when a failure occurs during normal processing.  The summary of this function is to copy and store the current fault content into a global circular buffer.</p><div><ul><li>The calling functions pass an address of variable.  The type of the variable is &#8216;FAULT_LOG_INFO_T&#8217; (containing 10 32 bit fields).</li><li>This function takes as an input type of &#8216;FAULT_LOG_INFO_T&#8217;</li><li>At line 22, this function casts its input argument to pointer to u32</li><li>At line 25, this function validates the circular buffer index counter before using it (at line 33).</li><li>At line 34, this function copies the current fault contents (12 elements!) into a global variable buffer (FaultInfoElement)</li><li>At line 37, this function clears the current fault content to 0.</li><li>At line 38, this function increment the pointer by 1.</li></ul></div><p><b>What is the issue?</b> &#8211; The memory locations between Fault Log info and the Shared data (variables those are shared between hand and auto generated code) are adjacent.  Because of that, this function writes into the next memory (cruse on/off switch and other shared variables) on the 11th iteration.  (i.e: at line 34 this function clears the pointers content to 0, at the 11th iteration this function is clearing all the shared variables).</p><p>This figure illustrates simulates the memory overlap between shared memory data and fault log info:</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_09.png" alt=""> </p><p>What is the fix? This function should only increment 0..9 not 0..11, because the &#8216;FAULT_LOG_INFO_T&#8217; only contains 10 elements, not 12.</p><p><b>What changed?</b></p><p>Note between &#8220;NEW&#8221; and &#8220;OLD&#8221; fault log typedef structure below: This source line is located in "bit.h" in the "include" folder.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_10.png" alt=""> </p><p>Let&#8217;s look at the second issue that is causing the target not to exceed 40MPH.</p><p>We will be using Polyspace to navigate and identify the root cause of the issue.</p><p><img vspace="5" hspace="5" src="Step_07_PS_Code_Prover_Check_Step_11.png" alt=""> </p><h2>Summary<a name="4"></a></h2><p>Performing early individual module unit testing will prevent defects getting into the system.  What make the final product is the integration functionality of the system.  Using a static analysis tool like Polyspace prevents run-time error getting into your system and saves troubleshooting time.</p><p>More information about Polyspace Code Prover Checks can be found using this link: <a href="http://www.mathworks.com/help/codeprover/ug/check-types.html">http://www.mathworks.com/help/codeprover/ug/check-types.html</a></p><p>More information about Polyspace Bug Finder Checks can be found using this link: <a href="http://www.mathworks.com/help/bugfinder/defect-reference.html">http://www.mathworks.com/help/bugfinder/defect-reference.html</a></p><p>When you are finished, close all models and files - or <b><a href="matlab:bdclose('all');">click here</a></b>.</p><p>Please go to <b>Step 8: Property Proving</b> - <b><a href="Step_08.html">click here</a></b></p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Step 7: Integration Code Verification 
%
%% Introduction
%
% In most embedded system, the final product contains hand and auto gen
% code that will be downloaded into processor.  In this workshop will go
% throught an example of simple scheduler, analog and discrete IO’s 
% processing, and fault log.  We will be use Polyspace Code Prover static
% analysis tool to detect run time error on the integrated 
% (hand and auto gen) code.
% 
% The following diagram describes the recommendation usage of Polyspace in
% the embedded system development where hand and auto generated code 
% integration is applicable. 
% 
% <<Step_07_PS_Code_Prover_Check_Step_12.png>>
% 
%% Verification and Validation Tools Used
% 
% * Polyspace Code Prover
%
%% Static verification 
% Creating Polyspace Code Prover project that contains hand code,
% S-Function, and Auto Generated Code.
%
% <<Step_07_PS_Code_Prover_Check_Step_01.png>>
%
% Provide name in the “Project Name” and “Location” fields.  
% The location field is where the results will be stored.  
% Keep the remaining default options and click "Next".
%
% Add the C source code files (.c) to the project and specifiy the folders
% containing include (.h) files in the include paths.  Add recursively only
% if there are subfolders containing source and include files you need to
% compile the source files.
%
% <<Step_07_PS_Code_Prover_Check_Step_02.png>>
%
% <<Step_07_PS_Code_Prover_Check_Step_03.png>>
%
% Most compiler specific language extensions are recognized by Polyspace
% by selecting compiler vendor and dialect in the setup.  For exotic
% extensions, there are extension hooks in the product that allow you to
% verify even the most extension laden source code. Select the gnu4.9 
% dialect in the compiler option for this example.
%
% <<Step_07_PS_Code_Prover_Check_Step_06.png>>
%
% Omit the main.c from the verification initially by right-clicking it and
% selecting "Exclude Files".
%
% <<Step_07_PS_Code_Prover_Check_Step_07.png>>
%
% *Save the Polyspace configuration and run.*
%
% In the next section we will review the Polyspace results.  Make hand code
% chnages and re-run Polyspace.
%
% *Reviewing Code Prover results*
%
% This is a run-time error in the hand code.  Please investigate the root
% cause of the issue. 
% 
% Modify the scheduler file at line 16 from “<=” to “<” and re-run Code
% Prover.
%
% <<Step_07_PS_Code_Prover_Check_Step_08.png>>
%
% A non-terminating loop caused the cruise control to power off during 
% fault testing.
%
% <<Step_07_PS_Code_Prover_Check_Step_08B.png>>
%
% The fault_log function is called when a failure occurs during
% normal processing.  The summary of this function is to copy and store
% the current fault content into a global circular buffer.
%
% * The calling functions pass an address of variable.  The type of the
% variable is ‘FAULT_LOG_INFO_T’ (containing 10 32 bit fields).
% * This function takes as an input type of ‘FAULT_LOG_INFO_T’
% * At line 22, this function casts its input argument to pointer to 
% u32
% * At line 25, this function validates the circular buffer index counter
% before using it (at line 33).
% * At line 34, this function copies the current fault contents 
% (12 elements!) into a global variable buffer (FaultInfoElement)
% * At line 37, this function clears the current fault content to 0.
% * At line 38, this function increment the pointer by 1.
%
%
% *What is the issue?* – The memory locations between Fault Log info and the
% Shared data (variables those are shared between hand and auto generated
% code) are adjacent.  Because of that, this function writes into
% the next memory (cruse on/off switch and other shared variables)
% on the 11th iteration.  (i.e: at line 34 this function clears
% the pointers content to 0, at the 11th iteration this function is
% clearing all the shared variables).
%
% This figure illustrates simulates the memory overlap between
% shared memory data and fault log info:
%
% <<Step_07_PS_Code_Prover_Check_Step_09.png>>
%
% What is the fix? This function should only increment 0..9 not 0..11,
% because the ‘FAULT_LOG_INFO_T’ only contains 10 elements, not 12.
%
% *What changed?*
%
% Note between “NEW” and “OLD” fault log typedef structure below: This
% source line is located in "bit.h" in the "include" folder.
%
% <<Step_07_PS_Code_Prover_Check_Step_10.png>>
%
% Let’s look at the second issue that is causing the target not to exceed
% 40MPH.
%
% We will be using Polyspace to navigate and identify the root cause of 
% the issue.
%
% <<Step_07_PS_Code_Prover_Check_Step_11.png>>
%
%% Summary
%
% Performing early individual module unit testing will prevent defects 
% getting into the system.  What make the final product is the integration
% functionality of the system.  Using a static analysis tool like Polyspace
% prevents run-time error getting into your system and saves 
% troubleshooting time.
% 
% More information about Polyspace Code Prover Checks can be found using this link: 
% http://www.mathworks.com/help/codeprover/ug/check-types.html
% 
% More information about Polyspace Bug Finder Checks can be found using this link:
% http://www.mathworks.com/help/bugfinder/defect-reference.html
% 
% When you are finished, close all models and files - or
% *<matlab:bdclose('all'); click here>*.
%
% Please go to *Step 8: Property Proving* - *<Step_08.html click here>*
%
##### SOURCE END #####
--></body></html>